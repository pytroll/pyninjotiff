name: Test deploy sdist

on:
  - push
  - pull_request

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout source
        uses: actions/checkout@v2

      - name: Install proj
        run: sudo apt-get install -y proj-bin

      - name: Build and publish to pypi
        uses: JRubics/poetry-publish@v1.9
        with:
          pypi_token: ${{ secrets.test_pypi_password }}
          build_format: "sdist"
          repository_name: "testpypi"
          repository_url: "https://test.pypi.org/legacy/"
